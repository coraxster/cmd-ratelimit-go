Rate-limit для командной строки.

Нужно написать утилиту, аналогичную xargs с ограничениями скорости запуска и количества параллельно запущенных команд. 

На каждую строчку stdin утилита запускает команду указанную в command-line аргументах. Команды запускаются не чаще, чем указано в аргументе "rate". Утилита должна уметь запускать несколько команд параллельно. В каждый момент времени должно быть запущено не более, чем указано в аргументе "inflight", команд.
 
Usage: ratelimit --rate <N> --inflight <P> <command...>
    --rate: максимальное кол-во запусков команды в секунду
    --inflight: максимальное кол-во параллельно запущенных команд
    <command...>: команда для запуска, {} в команде заменяется на строчку из stdin.

Например (в bash):
   $ for i in {1..60} ; do echo $i ; done | ./ratelimit --rate 15 --inflight 1 echo {}
Эта команда должна отработать за ~4с.

  $ (echo 1 ; sleep 3 ; echo 2 ; echo 3) | ./ratelimit --rate 1 --inflight 2 echo {}
Эта команда должна отработать за ~4с.

Предполагается, что будет использована только стандартная библиотека. На написание кода может уйти порядка 30-45 минут при хорошем знании go и стандартной библиотеки. Т.е. нужна только утилита и не ожидается, что дело дойдет до тестов, reusable-компонент, каких-то других фичей и тп.
